<div class="container mt-4">
  <h2 class="mb-4">GestiÃ³n de Reservas ðŸ“…</h2>

  <form [formGroup]="reservaForm" class="row g-3 mb-4 p-3 border rounded shadow-sm" (ngSubmit)="registroReserva()">
    <div class="col-md-4">
      <label class="form-label">Fecha Inicio</label>
      <input type="datetime-local" class="form-control" formControlName="fecha_inicio" />
    </div>

    <div class="col-md-4">
      <label class="form-label">Fecha Fin</label>
      <input type="datetime-local" class="form-control" formControlName="fecha_fin" />
    </div>

    <div class="col-md-4">
      <label class="form-label">Usuario</label>
      <select class="form-select" formControlName="usuario" [compareWith]="compararUsuario">
        <option [ngValue]="null" disabled selected>Seleccione un usuario</option>
        <ng-container *ngIf="usuario$ | async as usuarios">
          <option *ngFor="let u of usuarios" [ngValue]="u">{{ u.nombre }} {{ u.apellido }}</option>
        </ng-container>
      </select>
    </div>

    <div class="col-12 mt-3">
      <button type="submit" class="btn" [ngClass]="modoEdicion ? 'btn-warning' : 'btn-success'"
        [disabled]="reservaForm.invalid">
        {{ modoEdicion ? 'Actualizar Reserva' : 'Agregar Reserva' }}
      </button>
      <button *ngIf="modoEdicion" type="button" class="btn btn-secondary ms-2"
        (click)="resetFormulario()">Cancelar</button>
    </div>
  </form>

  <div class="table-responsive mt-4">
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Fecha Inicio</th>
          <th>Fecha Fin</th>
          <th>ID Usuario</th>
          <th>Acciones</th>
        </tr>
      </thead>
     <tbody>
  <ng-container *ngIf="reservas$ | async as reservas; else cargando">
    <tr *ngFor="let res of reservas">
      <td>{{ res.id }}</td>
      <td>{{ res.fecha_inicio }}</td>
      <td>{{ res.fecha_fin }}</td>
      <td>{{ res.usuario.id }}</td>
      <td>
        <button class="btn btn-warning btn-sm" (click)="editarReserva(res)">Editar</button>
  <button class="btn btn-danger btn-sm" [disabled]="!res.id" (click)="res.id && eliminarReserva(res.id)">Eliminar</button>


      </td>
    </tr>

    <tr *ngIf="reservas.length === 0">
      <td colspan="5">No hay reservas registradas.</td>
    </tr>
  </ng-container>

  <ng-template #cargando>
    <tr>
      <td colspan="5">Cargando reservas...</td>
    </tr>
  </ng-template>
</tbody>
